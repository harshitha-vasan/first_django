{% extends 'main.html' %}

{% block content %}
{% load static %}
<div style="margin-top: 5%">
    <div>
        <form method="get" class="d-flex mb-4">
            <input type="text" name="search" class="from-control me-2" placeholder="Search Here"
                value="{{ search_query }}">
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>
    <form action="/delete_multiple/" method="POST">
        {% csrf_token %}
        <table class="table">
            <tr>
                <th><input type="checkbox" id="select-all"></th>
                <th>
                    Name
                </th>
                <th>
                    Email
                </th>
                <th>
                    Phone
                </th>
                <th>
                    Subject
                </th>
                <th>
                    Message
                </th>
                {% if 'harshithavasan1642@gmail.com' == request.session.email %}
                <th>
                    Session
                </th>
                <th>
                    Screenshot
                </th>
                <th>Update</th>
                <th>Delete</th>
                {% endif %}
            </tr>
            {% for data in datas %}
            {% if data.session_id == request.session.email and 'harshithavasan1642@gmail.com' != request.session.email
            %}
            <tr>
                <td><input type="checkbox" name="selected_items" value="{{ data.id }}"></td>
                <td>{{ data.name }}</td>
                <td>{{ data.email }}</td>
                <td>{{ data.phone }}</td>
                <td>{{ data.subject }}</td>
                <td>{{ data.message }}</td>
                <td><img src="{{ data.screenshot }}" alt="" width="250px"></td>
                <!-- <td>{{data.session_id}}</td>
            <td><a href="/update/{{ data.id }}" class="btn btn-outline-warning">Update</a></td>
            <td><a href="/delete/{{ data.id }}" class="btn btn-outline-danger">Delete</td> -->
            </tr>
            {% elif 'harshithavasan1642@gmail.com' == request.session.email %}
            <tr>
                <td><input type="checkbox" name="selected_items" value="{{ data.id }}"></td>
                <td>{{ data.name }}</td>
                <td>{{ data.email }}</td>
                <td>{{ data.phone }}</td>
                <td>{{ data.subject }}</td>
                <td>{{ data.message }}</td>
                <td>{{ data.session_id }}</td>
                <!-- <img src="{{ data.screenshot }}" alt="" width="250px"> -->
                <td><img src="{{ data.screenshot.url }}" alt="{{ data.screenshot.url }}" width="250px"></td>
                <td><a href="/update/{{ data.id }}" class="btn btn-outline-warning">Update</a></td>
                <td><a href="/delete/{{ data.id }}" class="btn btn-outline-danger">Delete</td>
            </tr>
            {% endif %}
            {% endfor %}
        </table>
        <button type="submit">Delete</button>
    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const selectAllCheckbox = document.getElementById("select-all");
        const checkBoxes = document.querySelectorAll('input[name="selected_items"]');

        selectAllCheckbox.addEventListener("change", function () {
            checkBoxes.forEach(checkbox => checkbox.checked = this.checked);
        });
    })
</script>

{% endblock content %}